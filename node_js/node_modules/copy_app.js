var http=require('http'),
    fs=require('fs'),
    //Never use a Sync function except at start-up!
    index=fs.readFileSync(__dirname+'/copy_index.html');
	
//Send index.html to all requests
var app=http.createServer(function(req,res){
	res.writeHead(200,{'Content-Type': 'text/html'});
	res.end(index);
});

//Socket.io server listens to our app
var io=require('socket.io').listen(app);

//Send current time to all connected clients
/*function sendTime() {
	io.emit('time',{time:new require('moment-timezone')().tz('Asia/Singapore').format().replace('T',' ').substr(0,19)});
}*/
var mypath='100.py'
var PythonShell=require('python-shell')
var pyshell=new PythonShell(mypath)
/*function send_shell() {
	pyshell.on('shell-on',function(shell_data){
	io.emit('shell_message',{shell_message:shell_data})
	})
}*/
//var a=1000
/*	function send_shell(){
	io.emit('shell',{_message:a})
	}*/
//send_shell()
/*	function send_shell(){
	io.emit('shell',{_message:'testing message emmit'})
	}*/
/*function send_shell(){
	pyshell.on('shell-on',function(shell_message){
	io.emit('shell',{_message:shell_message})
	})
}*/

//Send current time every 10 secs
//setInterval(send_shell,10000);
var a=1000
//Emit welcome message on connection
io.on('connection',function(socket){
	//use socket to commuicate with this particular client only, sending it it'sown id
	socket.emit('welcome',{message: 'Welcome! \xa0 '+' ID:'+ socket.id});

	socket.on('i am client',console.log);

	socket.emit('hello',{world:a})
	
	pyshell.on('py_message',function(message){
		var b=message
		socket.emit('shell',{'_message':b})

	})
});
//setInterval(send_shell,10000)
app.listen(3000);

